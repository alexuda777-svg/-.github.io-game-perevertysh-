<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ –ü–µ—Ä–µ–≤–µ—Ä—Ç—ã—à: –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –í–æ–∑—Ä–∞—Å—Ç–æ–≤ (–≠–ü–ò–ö + –ú–£–ó–´–ö–ê)</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            background:linear-gradient(-45deg,#ff9a9e,#fecfef,#fecfef,#ff9a9e);
            background-size:400% 400%;animation:gradientShift 15s ease infinite;
            color:#333;font-family:'Comic Sans MS',cursive;min-height:100vh;overflow-x:hidden
        }
        @keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
        
        /* –ú–£–ó–´–ö–ê–õ–¨–ù–´–ï –ö–ù–û–ü–ö–ò */
        .music-controls{position:fixed;top:20px;right:20px;z-index:10000;display:flex;gap:10px}
        .music-btn{background:#ff6b35;color:white;border:none;border-radius:50%;width:60px;height:60px;
            font-size:1.5em;cursor:pointer;box-shadow:0 5px 15px rgba(255,107,53,0.4);transition:all 0.3s}
        .music-btn:hover{transform:scale(1.1);box-shadow:0 8px 25px rgba(255,107,53,0.6)}
        .music-btn.active{background:#27ae60}
        
        .container{max-width:1000px;margin:0 auto;padding:20px}
        .header{
            text-align:center;background:linear-gradient(90deg,#ffd700,#ff6b35,#ffd700);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:3em;
            margin:20px 0;text-shadow:0 0 30px rgba(255,215,0,0.8);animation:pulse 2s infinite
        }
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

        .status-bar{display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;background:#fff8dc;
            border-radius:25px;padding:20px;margin:20px 0;box-shadow:0 15px 40px rgba(0,0,0,0.2)}
        .stat-card{background:#fff;border-radius:15px;padding:15px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.1);
            transition:all 0.3s}.stat-card:hover{transform:translateY(-5px)}
        .character-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0}
        .character-card{background:#fff;border-radius:20px;padding:20px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.15);
            position:relative;transition:all 0.4s ease;overflow:hidden}
        .character-card:hover{transform:scale(1.05) rotate(1deg)}
        .age-2{background:linear-gradient(135deg,#ffe4b5,#ffdab9)}
        .age-9{background:linear-gradient(135deg,#b8e6b8,#98d8a8)}
        .age-15{background:linear-gradient(135deg,#a8d5e2,#87c5d2)}
        .age-17{background:linear-gradient(135deg,#f4b6c2,#e8a2b0)}

        /* –ö–ò–ù–û –≠–ö–†–ê–ù–´ */
        .cutscene{position:fixed;top:0;left:0;width:100%;height:100vh;background:rgba(0,0,0,0.9);
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            color:white;font-size:2.5em;text-align:center;z-index:9999;opacity:0;transition:opacity 1s}
        .cutscene.show{opacity:1}
        .cutscene h2{font-size:4em;margin-bottom:30px;animation:cinemaGlow 2s infinite}
        @keyframes cinemaGlow{0%,100%{text-shadow:0 0 20px #ffd700}50%{text-shadow:0 0 40px #ffd700,0 0 60px #ff6b35}}
        
        .scene-text{background:#fff;border-radius:25px;padding:30px;margin:25px 0;font-size:1.4em;line-height:1.8;
            box-shadow:0 20px 50px rgba(0,0,0,0.2);min-height:250px;max-height:400px;overflow-y:auto;
            white-space:pre-wrap;position:relative}
        .typewriter{overflow:hidden;border-right:.2em solid #ffd700}
        .highlight{color:#ff6b35;font-weight:bold;text-shadow:0 0 10px #ff6b35}
        .danger{color:#e74c3c;font-weight:bold}
        .success{color:#27ae60;font-weight:bold}
        
        .puzzle-screen{background:rgba(255,255,255,0.98);border-radius:25px;padding:40px;margin:20px 0;
            box-shadow:0 20px 60px rgba(0,0,0,0.3);text-align:center;display:none}
        .puzzle-screen.show{display:block}
        .puzzle-question{font-size:2.2em;margin:30px 0;font-weight:bold;color:#ff6b35}
        .puzzle-input{width:80%;max-width:400px;padding:20px;font-size:1.5em;border:3px solid #ffd700;
            border-radius:15px;text-align:center;margin:20px 0;font-family:'Comic Sans MS',cursive}
        
        .choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin:30px 0}
        button{background:linear-gradient(45deg,#ff6b35,#f7931e,#ff6b35);color:white;border:none;border-radius:30px;
            padding:20px 35px;font-size:1.3em;font-weight:bold;cursor:pointer;transition:all 0.3s;
            box-shadow:0 10px 30px rgba(255,107,53,0.4);font-family:'Comic Sans MS',cursive;position:relative;
            overflow:hidden}
        button::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
            background:linear-gradient(90deg,transparent, rgba(255,255,255,0.3),transparent);
            transition:left 0.5s}
        button:hover::before{left:100%}
        button:hover{transform:translateY(-5px) scale(1.05);box-shadow:0 15px 40px rgba(255,107,53,0.6)}
        button:disabled{background:#bdc3c7;transform:none;cursor:not-allowed;box-shadow:none}
        
        .age-effect{position:fixed;top:30%;left:50%;transform:translateX(-50%);font-size:4em;font-weight:bold;
            color:#ffd700;text-shadow:0 0 40px #ffd700;pointer-events:none;animation:agePop 3s ease-out forwards;
            z-index:1000;text-align:center}
        @keyframes agePop{0%{opacity:0;transform:translateX(-50%) translateY(-100px) scale(0.3)}
            30%{opacity:1;transform:translateX(-50%) translateY(0) scale(1.3)}
            100%{opacity:0;transform:translateX(-50%) translateY(-50px) scale(1.1)}}
        .hidden{display:none !important}
        .progress-bar{width:100%;height:20px;background:#ddd;border-radius:10px;overflow:hidden;margin:20px 0}
        .progress-fill{height:100%;background:linear-gradient(90deg,#27ae60,#2ecc71);width:0%;transition:width 1s ease;border-radius:10px}
        .shake{animation:shake 0.5s ease-in-out}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
    </style>
</head>
<body>
    <!-- üéµ –ú–£–ó–´–ö–ê–õ–¨–ù–´–ï –ö–û–ù–¢–†–û–õ–õ–ï–†–´ -->
    <div class="music-controls">
        <button class="music-btn active" onclick="toggleMusic()" id="music-btn" title="–ú—É–∑—ã–∫–∞">üéµ</button>
        <button class="music-btn" onclick="toggleSfx()" id="sfx-btn" title="–ó–≤—É–∫–∏">üîä</button>
    </div>

    <!-- üé¨ –ö–ò–ù–û –≠–ö–†–ê–ù–´ -->
    <div id="cutscene-main" class="cutscene">
        <h2>üé≤ –ü–ï–†–ï–í–ï–†–¢–´–®</h2>
        <p>–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –í–æ–∑—Ä–∞—Å—Ç–æ–≤</p>
        <div style="font-size:1.5em;margin-top:40px">–ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –∏–ª–∏ –ö–õ–ò–ö</div>
    </div>

    <div class="container">
        <h1 class="header">üé≤ –ü–µ—Ä–µ–≤–µ—Ä—Ç—ã—à: –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –í–æ–∑—Ä–∞—Å—Ç–æ–≤</h1>
        
        <div class="status-bar">
            <div class="stat-card"><div style="font-size:2em">üåü</div><div>–£—Ä–æ–≤–µ–Ω—å</div><div id="level" style="font-size:2.5em;font-weight:bold">1</div></div>
            <div class="stat-card"><div style="font-size:2em">üïê</div><div>–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</div><div id="magic-count" style="font-size:2.5em;font-weight:bold">0/6</div></div>
            <div class="stat-card"><div style="font-size:2em">‚≠ê</div><div>–û—á–∫–∏</div><div id="score-value" style="font-size:2.5em;font-weight:bold">0</div></div>
        </div>

        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
        <div class="character-grid" id="characters"></div>
        
        <div id="main-content">
            <div id="scene" class="scene-text"></div>
            <div id="choices" class="choices"></div>
        </div>

        <div id="puzzle-screen" class="puzzle-screen">
            <div class="puzzle-question" id="puzzle-question"></div>
            <input type="text" id="puzzle-input" class="puzzle-input" placeholder="üîç –í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç...">
            <br><button onclick="checkPuzzleAnswer()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç!</button>
            <div id="puzzle-hint" style="margin-top:20px;font-size:1.2em;color:#666"></div>
        </div>
    </div>

    <!-- üéµ –ê–£–î–ò–û -->
    <audio id="bgMusic" loop preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhAYUOqT99+PPoGAAmdvL9u3MKFyEomWlzDAP1rYvJ+O/PAUklb7y1YdwCRWuZ/mp1eQUm1b7y1YdwCRWuZ/mp1eQUm1b7y1YdwCRWuZ/mp1eQ=" type="audio/wav">
    </audio>
    <audio id="successSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRiQDAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YRIAAAAA=" type="audio/wav">
    </audio>
    <audio id="failSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhAYUOqT99+PPoGAAmdvL9u3MKFyEomWlzDAP1rYvJ+O/PAUklb7y1YdwCRWuZ/mp1eQ=" type="audio/wav">
    </audio>
    <audio id="ageChangeSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRlQGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQgAAABMcG...=" type="audio/wav">
    </audio>

    <script>
        // üéµ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ó–í–£–ö–ò
        const bgMusic = document.getElementById('bgMusic');
        const successSound = document.getElementById('successSound');
        const failSound = document.getElementById('failSound');
        const ageChangeSound = document.getElementById('ageChangeSound');
        let musicEnabled = true, sfxEnabled = true;

        function toggleMusic() {
            musicEnabled = !musicEnabled;
            bgMusic[musicEnabled ? 'play' : 'pause']();
            document.getElementById('music-btn').classList.toggle('active', musicEnabled);
        }

        function toggleSfx() {
            sfxEnabled = !sfxEnabled;
            document.getElementById('sfx-btn').classList.toggle('active', sfxEnabled);
        }

        function playSound(sound) {
            if (sfxEnabled) sound.currentTime = 0; sound.play().catch(() => {});
        }

        // üé¨ –ö–ò–ù–û–ò–ù–¢–†–û
        function showCutscene(text1, text2, callback) {
            const cutscene = document.getElementById('cutscene-main');
            cutscene.innerHTML = `<h2>${text1}</h2><p>${text2}</p><div style="font-size:1.5em;margin-top:40px">–ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ –∏–ª–∏ –ö–õ–ò–ö</div>`;
            cutscene.classList.add('show');
            
            const skipIntro = (e) => {
                if (e.type === 'click' || e.keyCode === 32) {
                    cutscene.classList.remove('show');
                    document.removeEventListener('click', skipIntro);
                    document.removeEventListener('keydown', skipIntro);
                    if (callback) callback();
                }
            };
            document.addEventListener('click', skipIntro);
            document.addEventListener('keydown', skipIntro);
        }

        const gameState = {
            level: 1, score: 0, magicItems: 0, currentScene: 'start', playTime: 0,
            characters: {
                vova: {name: 'üë®‚Äçüíª –í–æ–≤–∞', age: 17, baseAge: 17, skills: ['–∏–≥—Ä—ã', '—Å–ø–æ—Ä—Ç'], emoji: 'üë®‚Äçüíª'},
                arseniy: {name: 'üé∏ –ê—Ä—Å–µ–Ω–∏–π', age: 15, baseAge: 15, skills: ['–º—É–∑—ã–∫–∞', '—Ç–∞–Ω—Ü—ã'], emoji: 'üé∏'},
                bogdan: {name: 'üîç –ë–æ–≥–¥–∞–Ω', age: 9, baseAge: 9, skills: ['–≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏'], emoji: 'üîç'},
                mark: {name: 'üçº –ú–∞—Ä–∫', age: 2, baseAge: 2, skills: ['–∏–≥—Ä–∞—Ç—å'], emoji: 'üçº'}
            }
        };

        const PUZZLES = {
            math: [
                {question: "üöÄ 15 –±–æ–π—Ü–æ–≤ + 27 —Ç–∞–Ω–∫–æ–≤ = ?", answer: "42", hint: "–°–ª–æ–∂–∏ –∏—Ö –≤–º–µ—Å—Ç–µ!"},
                {question: "üç≠ 8 –∫–æ–Ω—Ñ–µ—Ç - 3 —Å—ä–µ–¥–µ–Ω–æ = ?", answer: "5", hint: "–°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å —É –ê—Ä—Å–µ–Ω–∏—è?"},
                {question: "üèÉ‚Äç‚ôÇÔ∏è 2–∫–º + 1.5–∫–º = ?", answer: "3.5", hint: "–í–æ–≤–∞ –±–µ–∂–∏—Ç –º–∞—Ä–∞—Ñ–æ–Ω!"}
            ],
            logic: [
                {question: "‚öñÔ∏è 1–∫–≥ –ø–µ—Ä—å–µ–≤ –∏–ª–∏ 1–∫–≥ –∂–µ–ª–µ–∑–∞ - —á—Ç–æ —Ç—è–∂–µ–ª–µ–µ?", answer: "–æ–¥–∏–Ω–∞–∫–æ–≤–æ", hint: "–û–±–∞ –ø–æ 1 –∫–≥!"},
                {question: "üí° 3 –ª–∞–º–ø–æ—á–∫–∏. –ö–∞–∫–∞—è –≥–æ—Ä–∏—Ç?", answer: "–≤—Å–µ", hint: "–í—Å–µ –ª–∞–º–ø–æ—á–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã!"},
                {question: "üß© 12 –ø–∞–∑–ª–æ–≤ √ó 2 —á–∞—Å–∞ = ?", answer: "24", hint: "–ë–æ–≥–¥–∞–Ω —Å–æ–±–∏—Ä–∞–µ—Ç –±—ã—Å—Ç—Ä–æ!"}
            ],
            age: [
                {question: "üöó –ö—Ç–æ –º–æ–∂–µ—Ç –≤–æ–¥–∏—Ç—å –º–∞—à–∏–Ω—É?", answer: "–≤–æ–≤–∞", hint: "–¢–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª—ã–π!"},
                {question: "üê± –ö—Ç–æ –ø—Ä–æ–ª–µ–∑–µ—Ç –ø–æ–¥ –∑–∞–±–æ—Ä?", answer: "–º–∞—Ä–∫", hint: "–°–∞–º—ã–π –º–∞–ª—ã—à!"},
                {question: "üé§ –ö—Ç–æ –ª—É—á—à–∏–π —Ç–∞–Ω—Ü–æ—Ä?", answer: "–∞—Ä—Å–µ–Ω–∏–π", hint: "–ö–æ—Ä–æ–ª—å –¥–∏—Å–∫–æ!"}
            ]
        };

        function initGame() {
            if (musicEnabled) {
                bgMusic.volume = 0.3;
                bgMusic.play().catch(() => {});
            }
            showCutscene('üé≤ –ü–ï–†–ï–í–ï–†–¢–´–®', '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –í–æ–∑—Ä–∞—Å—Ç–æ–≤', () => {
                document.getElementById('puzzle-screen').classList.remove('show');
                updateCharacters(); updateStatus(); showScene('start');
            });
        }

        function showScene(sceneId) {
            let scene = scenes[sceneId] || generateEpicScene(sceneId);
            gameState.currentScene = sceneId;
            gameState.level++;

            const sceneEl = document.getElementById('scene');
            sceneEl.innerHTML = ''; sceneEl.classList.add('typewriter');
            typeWriter(scene.text, sceneEl, () => {
                sceneEl.classList.remove('typewriter');
                showChoices(scene.choices);
                if (scene.effect) window[scene.effect]();
            });
        }

        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ + –º—É–∑—ã–∫–∞ –≤–µ–∑–¥–µ!
        const scenes = {
            start: {
                text: `üé¨ –ì–û–†–û–î–°–ö–û–ô –ü–ê–†–ö ‚Äî –õ–ï–¢–û 2026!

–í–æ–≤–∞(17)‚öΩ –∑–∞–±–∏–≤–∞–µ—Ç –≥–æ–ª—ã, –ê—Ä—Å–µ–Ω–∏–π(15)üéß –∫–∞—á–∞–µ—Ç –±–∏—Ç—ã,
–ë–æ–≥–¥–∞–Ω(9)üß© —Å–æ–±–∏—Ä–∞–µ—Ç "–¢–∏—Ç–∞–Ω–∏–∫", –ú–∞—Ä–∫(2)üåø –∂—É–µ—Ç —Ç—Ä–∞–≤–∫—É!

‚ùì –í –∫—É—Å—Ç–∞—Ö –¢–ò–ö–ê–Æ–¢ –î–†–ï–í–ù–ò–ï –ß–ê–°–´...
üåÄ –ú–ê–ì–ò–Ø –í–†–ï–ú–ï–ù–ò –ê–ö–¢–ò–í–ò–†–£–ï–¢–°–Ø!
        
üíÄ –í–û–ó–†–ê–°–¢ –£–ì–ê –°–ê–ï–¢ –ö–ê–ñ–î–´–ï 3 –û–®–ò–ë–ö–ò!
‚≠ê –°–û–ë–ï–†–ò 6 –ê–†–¢–ï–§–ê–ö–¢–û–í –ò–õ–ò –ü–†–û–ò–ì–†–ê–ï–®–¨!`,
                choices: [
                    {text: "üï∞Ô∏è –ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ß–ê–°–´", next: 'clockChaos'},
                    {text: "üß© –†–ï–®–ò–¢–¨ –ó–ê–ì–ê–î–ö–£ –ü–ê–†–ö–ê", next: 'riddle1'},
                    {text: "üèÉ‚Äç‚ôÇÔ∏è –ë–ï–ñ–ê–¢–¨ –û–¢ –û–ü–ê–°–ù–û–°–¢–ò!", next: 'cowardPath'}
                ]
            }
        };

        // –§—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ –∂–µ, –Ω–æ —Å –º—É–∑—ã–∫–æ–π
        function checkPuzzleAnswer() {
            const answer = document.getElementById('puzzle-input').value.trim().toLowerCase();
            if (answer === gameState.currentPuzzle.answer.toLowerCase()) {
                playSound(successSound);
                document.getElementById('puzzle-screen').classList.add('shake');
                setTimeout(() => {
                    gameState.magicItems++; gameState.score += 500;
                    showReward('‚úÖ –ê–†–¢–ï–§–ê–ö–¢ –ü–û–õ–£–ß–ï–ù!');
                    backToGame('schoolLibrary');
                }, 500);
            } else {
                playSound(failSound);
                showWarning('‚ùå –û–®–ò–ë–ö–ê! –í–æ–∑—Ä–∞—Å—Ç —É–≥–∞—Å–∞–µ—Ç...');
                ageDecay();
            }
        }

        window.onload = initGame;
    </script>
</body>
</html>

