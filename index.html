<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ –ü–µ—Ä–µ–≤–µ—Ä—Ç—ã—à: –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –í–æ–∑—Ä–∞—Å—Ç–æ–≤ (–≠–ü–ò–ö)</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            background:linear-gradient(-45deg,#ff9a9e,#fecfef,#fecfef,#ff9a9e);
            background-size:400% 400%;animation:gradientShift 15s ease infinite;
            color:#333;font-family:'Comic Sans MS',cursive;min-height:100vh;overflow-x:hidden
        }
        @keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
        .container{max-width:1000px;margin:0 auto;padding:20px}
        .header{
            text-align:center;background:linear-gradient(90deg,#ffd700,#ff6b35,#ffd700);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:3em;
            margin:20px 0;text-shadow:0 0 30px rgba(255,215,0,0.8);animation:pulse 2s infinite
        }
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
        .status-bar{display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;background:#fff8dc;
            border-radius:25px;padding:20px;margin:20px 0;box-shadow:0 15px 40px rgba(0,0,0,0.2)}
        .stat-card{background:#fff;border-radius:15px;padding:15px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.1);
            transition:all 0.3s}.stat-card:hover{transform:translateY(-5px)}
        .character-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0}
        .character-card{background:#fff;border-radius:20px;padding:20px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.15);
            position:relative;transition:all 0.4s ease;overflow:hidden}
        .character-card:hover{transform:scale(1.05) rotate(1deg)}
        .age-2{background:linear-gradient(135deg,#ffe4b5,#ffdab9)}
        .age-9{background:linear-gradient(135deg,#b8e6b8,#98d8a8)}
        .age-15{background:linear-gradient(135deg,#a8d5e2,#87c5d2)}
        .age-17{background:linear-gradient(135deg,#f4b6c2,#e8a2b0)}
        .scene-text{background:#fff;border-radius:25px;padding:30px;margin:25px 0;font-size:1.4em;
            line-height:1.8;box-shadow:0 20px 50px rgba(0,0,0,0.2);min-height:250px;max-height:400px;
            overflow-y:auto;white-space:pre-wrap}
        .typewriter{overflow:hidden;border-right:.2em solid #ffd700}
        .highlight{color:#ff6b35;font-weight:bold;text-shadow:0 0 10px #ff6b35}
        .danger{color:#e74c3c;font-weight:bold}
        .success{color:#27ae60;font-weight:bold}
        .puzzle-screen{background:rgba(255,255,255,0.95);border-radius:25px;padding:40px;margin:20px 0;
            box-shadow:0 20px 60px rgba(0,0,0,0.3);text-align:center}
        .puzzle-question{font-size:2em;margin:30px 0;font-weight:bold;color:#ff6b35}
        .puzzle-input{width:100%;padding:20px;font-size:1.5em;border:3px solid #ffd700;
            border-radius:15px;text-align:center;margin:20px 0;font-family:'Comic Sans MS',cursive}
        .choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin:30px 0}
        button{background:linear-gradient(45deg,#ff6b35,#f7931e,#ff6b35);color:white;border:none;
            border-radius:30px;padding:20px 35px;font-size:1.3em;font-weight:bold;cursor:pointer;
            transition:all 0.3s;box-shadow:0 10px 30px rgba(255,107,53,0.4);font-family:'Comic Sans MS',cursive}
        button:hover{transform:translateY(-5px) scale(1.05);box-shadow:0 15px 40px rgba(255,107,53,0.6)}
        button:disabled{background:#bdc3c7;transform:none;cursor:not-allowed;box-shadow:none}
        .age-effect{position:fixed;top:30%;left:50%;transform:translateX(-50%);font-size:4em;font-weight:bold;
            color:#ffd700;text-shadow:0 0 40px #ffd700;pointer-events:none;animation:agePop 3s ease-out forwards;
            z-index:1000;text-align:center}
        @keyframes agePop{0%{opacity:0;transform:translateX(-50%) translateY(-100px) scale(0.3)}
            30%{opacity:1;transform:translateX(-50%) translateY(0) scale(1.3)}
            100%{opacity:0;transform:translateX(-50%) translateY(-50px) scale(1.1)}}
        .hidden{display:none !important}
        .progress-bar{width:100%;height:20px;background:#ddd;border-radius:10px;overflow:hidden;margin:20px 0}
        .progress-fill{height:100%;background:linear-gradient(90deg,#27ae60,#2ecc71);width:0%;transition:width 1s ease;
            border-radius:10px}
        .shake{animation:shake 0.5s ease-in-out}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">üé≤ –ü–µ—Ä–µ–≤–µ—Ä—Ç—ã—à: –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –í–æ–∑—Ä–∞—Å—Ç–æ–≤</h1>
        
        <div class="status-bar">
            <div class="stat-card"><div style="font-size:2em">üåü</div><div>–£—Ä–æ–≤–µ–Ω—å</div><div id="level" style="font-size:2.5em;font-weight:bold">1</div></div>
            <div class="stat-card"><div style="font-size:2em">üïê</div><div>–ü—Ä–µ–¥–º–µ—Ç—ã</div><div id="magic-count" style="font-size:2.5em;font-weight:bold">0/6</div></div>
            <div class="stat-card"><div style="font-size:2em">‚≠ê</div><div>–û—á–∫–∏</div><div id="score-value" style="font-size:2.5em;font-weight:bold">0</div></div>
        </div>

        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

        <div class="character-grid" id="characters"></div>
        
        <div id="main-content">
            <div id="scene" class="scene-text"></div>
            <div id="choices" class="choices"></div>
        </div>

        <!-- –ù–û–í–´–ï –ó–ê–î–ê–ß–ö–ò -->
        <div id="puzzle-screen" class="puzzle-screen hidden">
            <div class="puzzle-question" id="puzzle-question"></div>
            <input type="text" id="puzzle-input" class="puzzle-input" placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç...">
            <br><button onclick="checkPuzzleAnswer()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å!</button>
            <div id="puzzle-hint" style="margin-top:20px;font-size:1.2em;color:#666"></div>
        </div>
    </div>

    <script>
        const gameState = {
            level: 1, score: 0, magicItems: 0, currentScene: 'start', playTime: 0,
            puzzleHistory: [], timeLimits: {},
            characters: {
                vova: {name: 'üë®‚Äçüíª –í–æ–≤–∞', age: 17, baseAge: 17, skills: ['–∏–≥—Ä—ã', '—Å–ø–æ—Ä—Ç'], emoji: 'üë®‚Äçüíª'},
                arseniy: {name: 'üé∏ –ê—Ä—Å–µ–Ω–∏–π', age: 15, baseAge: 15, skills: ['–º—É–∑—ã–∫–∞', '—Ç–∞–Ω—Ü—ã'], emoji: 'üé∏'},
                bogdan: {name: 'üîç –ë–æ–≥–¥–∞–Ω', age: 9, baseAge: 9, skills: ['–≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏'], emoji: 'üîç'},
                mark: {name: 'üçº –ú–∞—Ä–∫', age: 2, baseAge: 2, skills: ['–∏–≥—Ä–∞—Ç—å'], emoji: 'üçº'}
            }
        };

        const PUZZLES = {
            math: [
                {question: "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 15 + 27?", answer: "42", hint: "–ü–æ–¥—Å–∫–∞–∑–∫–∞: 10+20=30, 5+7=12"},
                {question: "–£ –ê—Ä—Å–µ–Ω–∏—è 8 –∫–æ–Ω—Ñ–µ—Ç, –æ–Ω —Å—ä–µ–ª 3. –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å?", answer: "5", hint: "8-3=??"},
                {question: "–í–æ–≤–∞ –ø—Ä–æ–±–µ–∂–∞–ª 2 –∫–º, –µ—â–µ 1.5 –∫–º. –ò—Ç–æ–≥–æ?", answer: "3.5", hint: "2 + 1.5 = ?"}
            ],
            logic: [
                {question: "–ö–∞–∫–æ–π –≤–µ—Å–∏—Ç –±–æ–ª—å—à–µ: 1–∫–≥ –ø–µ—Ä—å–µ–≤ –∏–ª–∏ 1–∫–≥ –∂–µ–ª–µ–∑–∞?", answer: "–æ–¥–∏–Ω–∞–∫–æ–≤–æ", hint: "–û–±–∞ –ø–æ 1 –∫–≥!"},
                {question: "–£ —Ç–µ–±—è 3 –ª–∞–º–ø–æ—á–∫–∏. –ö–∞–∫–∞—è –≥–æ—Ä–∏—Ç?", answer: "–≤—Å–µ", hint: "–í—Å–µ –ª–∞–º–ø–æ—á–∫–∏ –≥–æ—Ä—è—Ç!"},
                {question: "–ë–æ–≥–¥–∞–Ω —Å–æ–±—Ä–∞–ª 12 –ø–∞–∑–ª–æ–≤ –∑–∞ —á–∞—Å. –°–∫–æ–ª—å–∫–æ –∑–∞ 2 —á–∞—Å–∞?", answer: "24", hint: "12 √ó 2"}
            ],
            age: [
                {question: "–ö—Ç–æ –∏–∑ –≤–∞—Å –º–æ–∂–µ—Ç –≤–æ–¥–∏—Ç—å –º–∞—à–∏–Ω—É?", answer: "–≤–æ–≤–∞", hint: "–¢–æ–ª—å–∫–æ 17-–ª–µ—Ç–Ω–∏–π!"},
                {question: "–ö—Ç–æ –ø—Ä–æ–ª–µ–∑–µ—Ç –ø–æ–¥ –∑–∞–±–æ—Ä?", answer: "–º–∞—Ä–∫", hint: "–°–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π!"},
                {question: "–ö—Ç–æ —Ç–∞–Ω—Ü—É–µ—Ç –ª—É—á—à–µ –≤—Å–µ—Ö?", answer: "–∞—Ä—Å–µ–Ω–∏–π", hint: "–õ—é–±–∏—Ç –º—É–∑—ã–∫—É!"}
            ]
        };

        const scenes = {
            start: {
                text: `üå≥ –ì–û–†–°–ö–û–ô –ü–ê–†–ö ‚Äî —è—Ä–∫–∏–π —Å–æ–ª–Ω–µ—á–Ω—ã–π –¥–µ–Ω—å!

–í–æ–≤–∞(17) –∑–∞–±–∏–≤–∞–µ—Ç –≥–æ–ª, –ê—Ä—Å–µ–Ω–∏–π(15) –∫–∞—á–∞–µ—Ç –±–∏—Ç—ã –≤ –Ω–∞—É—à–Ω–∏–∫–∞—Ö,
–ë–æ–≥–¥–∞–Ω(9) —Å–æ–±–∏—Ä–∞–µ—Ç –ø–∞–∑–ª "–¢–∏—Ç–∞–Ω–∏–∫", –ú–∞—Ä–∫(2) –∂—É–µ—Ç —Ç—Ä–∞–≤–∏–Ω–∫—É. üòÇ

–í –∫—É—Å—Ç–∞—Ö –¢–ò–ö–ê–Æ–¢ –°–¢–ê–†–´–ï –ß–ê–°–´... 
üåÄ –í–†–ï–ú–Ø –°–ë–ò–í–ê–ï–¢–°–Ø! –í–æ–∑—Ä–∞—Å—Ç—ã –º–µ–Ω—è—é—Ç—Å—è!`,
                choices: [
                    {text: "üïê –¢—Ä–æ–Ω—É—Ç—å –ß–ê–°–´ –º–∞–≥–∏–∏", next: 'clockChaos'},
                    {text: "üîç –û—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–≥–∞–¥–∫—É", next: 'riddle1'},
                    {text: "üèÉ –ë–ï–ñ–ê–¢–¨ –∏–∑ –ø–∞—Ä–∫–∞!", next: 'escapeFail'}
                ]
            },
            clockChaos: {
                text: `üåÄ –ë–£–£–£–ú! –ß–ê–°–´ –í–ó–û–†–í–ê–õ–ò–°–¨ –°–í–ï–¢–û–ú! ‚ö°

–í–æ–≤–∞ ‚Üí 2 –≥–æ–¥–∞ (–ø–æ–ª–∑–∞–µ—Ç –∏ –ø–ª–∞—á–µ—Ç!)
–ú–∞—Ä–∫ ‚Üí 17 –ª–µ—Ç (–ø–∏—à–µ—Ç –∫–æ–¥ –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–µ!)
–ê—Ä—Å–µ–Ω–∏–π ‚Üî –ë–æ–≥–¥–∞–Ω –ø–æ–º–µ–Ω—è–ª–∏—Å—å –º–µ—Å—Ç–∞–º–∏!

üíÄ –í–û–ó–†–ê–°–¢ –£–ì–ê –°–ê–ï–¢! –ù–∞–¥–æ –Ω–∞–π—Ç–∏ 6 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤!`,
                effect: 'ageChaos',
                choices: [{text: "üè´ –í –®–ö–û–õ–£ –∑–∞ 1-–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–º!", next: 'schoolMathPanic'}]
            }
        };

        function initGame() {
            document.getElementById('puzzle-screen').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            updateCharacters(); updateStatus(); showScene('start');
        }

        function showScene(sceneId) {
            let scene = scenes[sceneId] || generateEpicScene(sceneId);
            gameState.currentScene = sceneId;
            gameState.level++;

            const sceneEl = document.getElementById('scene');
            sceneEl.innerHTML = ''; sceneEl.classList.add('typewriter');
            typeWriter(scene.text, sceneEl, () => {
                sceneEl.classList.remove('typewriter');
                showChoices(scene.choices);
                if (scene.effect) window[scene.effect]();
            });
        }

        function showPuzzle(puzzleType) {
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('puzzle-screen').classList.remove('hidden');
            
            const puzzle = PUZZLES[puzzleType][Math.floor(Math.random() * PUZZLES[puzzleType].length)];
            gameState.currentPuzzle = puzzle;
            document.getElementById('puzzle-question').textContent = puzzle.question;
            document.getElementById('puzzle-hint').textContent = puzzle.hint;
            document.getElementById('puzzle-input').value = '';
            document.getElementById('puzzle-input').focus();
        }

        function checkPuzzleAnswer() {
            const answer = document.getElementById('puzzle-input').value.trim().toLowerCase();
            if (answer === gameState.currentPuzzle.answer.toLowerCase()) {
                document.getElementById('puzzle-screen').classList.add('shake');
                setTimeout(() => {
                    gameState.magicItems++; gameState.score += 500;
                    showReward('‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û! +1 –ê—Ä—Ç–µ—Ñ–∞–∫—Ç!');
                    backToGame('schoolLibrary');
                }, 500);
            } else {
                showWarning('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –í–æ–∑—Ä–∞—Å—Ç —É–≥–∞—Å–∞–µ—Ç...');
                ageDecay();
            }
        }

        function ageDecay() {
            Object.values(gameState.characters).forEach(char => {
                char.age = Math.max(2, char.age - 2);
                showAgeEffect(char.name, char.age, 'üîª');
            });
        }

        function ageGrowth() {
            Object.values(gameState.characters).forEach(char => {
                char.age = Math.min(17, char.age + 3);
                showAgeEffect(char.name, char.age, 'üî∫');
            });
        }

        function showReward(text) {
            const effect = document.createElement('div');
            effect.className = 'age-effect'; effect.style.color = '#27ae60';
            effect.innerHTML = text; document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 3000);
        }

        function showWarning(text) {
            const effect = document.createElement('div');
            effect.className = 'age-effect'; effect.style.color = '#e74c3c';
            effect.innerHTML = text; document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 3000);
        }

        function backToGame(nextScene) {
            document.getElementById('puzzle-screen').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            updateStatus(); updateCharacters(); showScene(nextScene);
        }

        // –ò–ì–†–û–í–´–ï –≠–§–§–ï–ö–¢–´
        function ageChaos() {
            const ages = [2,9,15,17]; Object.values(gameState.characters).forEach((char,i) => {
                char.age = ages[(i+gameState.level)%4]; 
                setTimeout(() => showAgeEffect(char.name, char.age), i*400);
            });
        }

        function showAgeEffect(name, age, icon = '‚ú®') {
            const effect = document.createElement('div');
            effect.className = 'age-effect'; effect.innerHTML = `${icon} ${name}: ${age} –ª–µ—Ç!`;
            document.body.appendChild(effect); setTimeout(() => effect.remove(), 3000);
        }

        function generateEpicScene(sceneId) {
            const epicEvents = [
                `‚ö° –í–û–ó–†–ê–°–¢–ù–´–ô –®–¢–û–†–ú! –í—Å–µ —Å—Ç–∞—Ä–µ—é—Ç/–º–æ–ª–æ–¥–µ—é—Ç!
–ù–∞–¥–æ —Ä–µ—à–∏—Ç—å –ú–ê–¢–ï–ú–ê–¢–ò–ß–ï–°–ö–£–Æ –ó–ê–î–ê–ß–£ –∑–∞ 30 —Å–µ–∫!`,
                `üß© –õ–û–ì–ò–ß–ï–°–ö–ê–Ø –õ–û–í–£–®–ö–ê! –û–¥–∏–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç = -2 –≥–æ–¥–∞ –≤—Å–µ–º!
–†–∞–∑–≥–∞–¥–∞–π –∑–∞–≥–∞–¥–∫—É –±—ã—Å—Ç—Ä–µ–Ω—å–∫–æ!`,
                `üé≠ –¢–ï–ê–¢–† –í–û–ó–†–ê–°–¢–û–í! –ù–∞–∑–æ–≤–∏ –∫—Ç–æ —á—Ç–æ —É–º–µ–µ—Ç!
–ü—Ä–∞–≤–∏–ª—å–Ω–æ = +3 –≥–æ–¥–∞ –ª–∏–¥–µ—Ä—É –∫–æ–º–∞–Ω–¥—ã!`
            ];
            return {
                text: epicEvents[Math.floor(Math.random()*3)],
                choices: [
                    {text: "üßÆ –†–µ—à–∏—Ç—å –ú–ê–¢–ï–ó–ê–î–ê–ß–£", next: 'math', puzzle: 'math'},
                    {text: "üß† –†–∞–∑–≥–∞–¥–∞—Ç—å –õ–û–ì–ò–ö–£", next: 'logic', puzzle: 'logic'},
                    {text: "üë• –ù–∞–∑–≤–∞—Ç—å –£–ú–ï–ù–ò–Ø", next: 'age', puzzle: 'age'}
                ]
            };
        }

        function typeWriter(text, element, callback) {
            element.innerHTML = ''; let i = 0;
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i); i++;
                    setTimeout(type, 40 + Math.random()*20);
                } else if (callback) callback();
            }
            type();
        }

        function showChoices(choices) {
            const choicesEl = document.getElementById('choices'); choicesEl.innerHTML = '';
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.innerText = choice.text;
                btn.onclick = () => {
                    if (choice.puzzle) showPuzzle(choice.puzzle);
                    else handleChoice(choice);
                };
                choicesEl.appendChild(btn);
            });
        }

        function handleChoice(choice) {
            gameState.score += 100; updateStatus(); updateCharacters();
            setTimeout(() => showScene(choice.next), 1200);
        }

        function updateCharacters() {
            const container = document.getElementById('characters'); container.innerHTML = '';
            Object.values(gameState.characters).forEach(char => {
                const card = document.createElement('div');
                card.className = `character-card age-${char.age}`;
                card.innerHTML = `<div style="font-size:3em">${char.emoji}</div>
                    <div style="font-size:1.3em;font-weight:bold">${char.name}</div>
                    <div style="font-size:2.8em">${char.age} –ª–µ—Ç</div>`;
                container.appendChild(card);
            });
        }

        function updateStatus() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('magic-count').textContent = `${gameState.magicItems}/6`;
            document.getElementById('score-value').textContent = gameState.score.toLocaleString();
            document.getElementById('progress-fill').style.width = Math.min(95, (gameState.level / 25) * 100) + '%';
        }

        setInterval(() => {gameState.playTime++;}, 1000);

        window.onload = initGame;
    </script>
</body>
</html>

